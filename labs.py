import os

os.environ.setdefault("DJANGO_SETTINGS_MODULE", "django_project.settings")

import django

django.setup()

from establishments.models import Establishment
import requests

cnes = [
    "9574514", "2528762", "2528797", "2528886", "2529041", "2529254",
    "2561166", "9939938", "2610949", "9233555", "9443398", "6959121",
    "9038140", "9040552", "2529068", "2529092", "0301337", "7905378",
    "4677099", "0407836", "7929935", "2481499", "7905351", "2482177",
    "2415585", "2482150", "3268055", "2561263", "9016368", "3950530",
    "2482274", "2482304", "2482452", "2482495", "2516691", "2482169",
    "2482487", "7047428", "2561131", "2529084", "2529114", "2529343",
    "2529475", "6446256", "2482118", "2528940", "0297658", "7532121",
    "9006052", "7918445", "7904886", "7614578", "7993218", "9023550",
    "9129553", "9000879", "9600949", "9044515", "2482347", "2482193",
    "2415593", "2415615", "6959083", "2482231", "2482282", "2482320",
    "2482460", "2482223", "9526293", "5065321", "6143865", "0297674",
    "7904339", "7434308", "5162270", "6959016", "6959040", "5162300",
    "6959059", "6959067", "6959202", "6959210", "2482215", "2528703",
    "2482444", "5963214", "2529009", "5098971", "6017274", "5162289",
    "5168333", "2561247", "2528789", "2528908", "2528878", "2529203",
    "2819481", "7919417", "2529211", "2482509", "2415607", "2528533",
    "2645106", "0452017", "4101197", "7517998", "2528738", "5075114",
    "2723212", "2528770", "2645114", "2516683", "2528932", "2528657",
    "2528967", "2529440", "7514948", "2561123", "2528894", "5162327",
    "2529181", "2528819", "2528827", "2529327", "2528959", "2482339",
    "2651378", "2529246", "2561115", "6958923", "2529076", "6958753",
    "6958761", "6958834", "6959075", "6958974", "6959008", "7980310",
    "2482207", "2482312", "2529238", "2482266", "2515261", "3394557",
    "2529033", "2561158", "2529106", "2528983", "2482142", "3394492",
    "6958990", "6959024", "6959032", "7429398", "2528975", "2482088",
    "6958931", "5963222", "6958966", "6959105", "6959113", "6959148",
    "6959156", "6959164", "6959199", "2478153", "7985274", "0245496",
    "7942451", "7907281", "5174368", "9439579", "9596925", "0393029",
    "0257168", "0472034", "9686479", "5128439", "7904908", "2516640",
    "7337280", "7337809", "2478137", "2482134", "3878562", "2528584",
    "2482290", "2482096", "2482126", "2528541", "2651351", "3394506",
    "2528991", "2528916", "2561204", "2528754", "5974976", "5331757",
    "2480603", "4276175", "4699785", "4573242", "4734327", "4674677",
    "4676629", "4707583", "4571886", "2516667", "4674464", "4573250",
    "4707125", "4584325", "4785142", "4718917", "4694759", "4777131",
    "4150643", "4673468", "4713524", "4644042", "4714288"
]

lista_estabs = []
for cne in cnes:
    url = f"https://apidadosabertos.saude.gov.br/cnes/estabelecimentos/{cne}"
    lista_estabs.append(requests.get(url=url).json())
    print(len(lista_estabs))

batch = [Establishment(**row) for row in lista_estabs]
Establishment.objects.bulk_create(batch)
print("Sincronização finalizada!")
